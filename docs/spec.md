# 映画視聴記録アプリ MIROKU 要件定義書

## 0. 目的・概要

MIROKU は、個人がこれまでに視聴した映画作品を記録・管理・分析するためのアプリである。
映画そのものの情報と、「いつ・どのように観たか」という視聴体験を分離して管理し、
後から自分の鑑賞履歴や傾向を振り返れることを目的とする。

本アプリは個人利用を前提とし、商用利用・レビュー公開・SNS共有機能は初期スコープ外とする。

---

## 1. 機能要件

### 1.1 認証・ユーザー管理

- メールアドレス＋パスワードによるログイン
- Supabase Auth を利用
- 機能
  - サインアップ
  - ログイン
  - ログアウト
  - パスワードリセット
- セキュリティ
  - ユーザーごとにデータを分離（Row Level Security 必須）
  - 他ユーザーのデータは参照不可

---

### 1.2 映画検索・登録（TMDB API連携）

- 映画検索
  - 入力：映画タイトル
  - TMDB API を利用して検索結果一覧を取得
  - 表示：タイトル、公開年、ポスター（サムネイル）
- 映画詳細取得
  - ユーザーが選択した映画について、TMDB API から詳細情報を取得
- TMDB から取得する初期データ
  - tmdb_movie_id
  - タイトル
  - サムネイル（ポスター画像）
  - 公開日
  - 制作国
  - 監督（director）
  - 脚本（writer）
  - キャスト（上位 10〜20 名）
    - キャストには tmdb_person_id を保持する
- API から取得したデータは「初期値」として保存し、後からユーザーが上書き可能

---

### 1.3 作品データ管理

- 映画は「作品（Movie）」として管理する
- 作品が持つ情報
  - タイトル
  - サムネイル
  - 公開日
  - 制作国
  - 監督（人物）
  - 脚本（人物）
  - キャスト（人物）
  - タグ（作品分類用）
  - 視聴回数（整数）
- 視聴回数について
  - 同じ映画を何回観たかをカウントするための数値
  - 監督・キャストなどの分析指標には使用しない
  - 分析では「作品を観たかどうか（1作品=1）」のみをカウント対象とする

---

### 1.4 視聴ログ管理

- 視聴ログは「映画を観た行為」を表すデータとして管理する
- 1作品に対して複数の視聴ログを持つことができる
- 視聴ログが持つ項目
  - 視聴日
  - 視聴方法
    - 映画館
    - テレビ
    - 配信
    - Blu-ray / DVD
    - その他（拡張可能）
  - 感想メモ（自由入力）
  - スコア（3段階）
    - Bad
    - Neutral
    - Good
- 視聴ログ操作
  - 登録
  - 編集
  - 削除
- 視聴ログ登録時に、対応する作品の「視聴回数」をインクリメントする

---

### 1.5 作品情報の上書き編集

- TMDB から取得した値は初期値として保持する
- ユーザーは以下の項目を上書き編集できる
  - タイトル
  - サムネイル
  - 公開日
  - 制作国
  - 監督・脚本・キャストの表記
- データ管理方針
  - TMDB由来データと、ユーザー上書きデータを分離して保持
  - 表示時はユーザー上書きデータを優先する

---

### 1.6 人物管理（監督・脚本・キャスト）

- 監督・脚本・キャストは共通の「人物（Person）」として管理する
- 人物データが持つ項目
  - 表示名
  - tmdb_person_id（存在する場合）
- 表記揺れ対策
  - ユーザーが明示的に人物をマージできる
  - 自動マージは行わない
  - マージ後は代表名をユーザーが指定できる
  - 「〇〇監督（前期）／〇〇監督（後期）」のように、あえて分けて管理することも可能
- マージ解除（アンマージ）が可能な設計とする

---

### 1.7 タグ管理

- タグは「作品」に対して付与する
- 用途例
  - ジャンル
  - テーマ
  - 気分
- タグはユーザーが自由に作成・編集できる
- 作品は複数のタグを持てる

---

### 1.8 検索・フィルタ

- 作品・視聴ログ一覧で以下の検索・絞り込みが可能
  - タイトル検索
  - タグによる絞り込み
  - 視聴方法による絞り込み
  - スコアによる絞り込み
  - 視聴年による絞り込み
  - 人物（監督・キャスト）からの絞り込み

---

### 1.9 分析機能

分析は「視聴した作品数」を基準に行う。

- 年ごとの映画視聴本数
  - 同一作品を複数回視聴していても 1 本としてカウント
- キャストごとの閲覧数グラフ
  - キャストが関与した「視聴済み作品数」をカウント
- 監督ごとの閲覧数グラフ
  - 監督が関与した「視聴済み作品数」をカウント
- 補足
  - 作品の視聴回数は分析には含めない（参考情報として保持のみ）

---

## 2. 非機能要件

- パフォーマンス
  - 一覧表示はページングまたは無限スクロール
- セキュリティ
  - Supabase RLS を必須とする
  - TMDB API キーはサーバー経由で管理する
- 可用性
  - Netlify + Supabase の標準構成を利用

---

## 3. 技術要件

- DB：Supabase（PostgreSQL）
- 認証：Supabase Auth
- サーバー：Netlify
- フロントエンド：
  - Next.js（React）を第一候補とする
- サーバー処理：
  - Netlify Functions
  - TMDB API のプロキシ処理
- グラフ描画：
  - Recharts または Chart.js（React向け）

---

## 4. データ設計方針（概要）

- Movie（作品）
- WatchLog（視聴ログ）
- Person（人物）
- Tag（タグ）
- 関係
  - Movie × Person（役割：director / writer / cast）
  - Movie × Tag
  - Movie × WatchLog

---

以上
